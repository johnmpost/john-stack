{"version":3,"file":"fiberRefs.js","names":["Equal","_interopRequireWildcard","require","_Function","HashSet","Option","_Pipeable","Arr","core","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","unsafeMake","fiberRefLocals","FiberRefsImpl","empty","Map","FiberRefsSym","exports","Symbol","for","locals","constructor","pipe","pipeArguments","arguments","findAncestor","_ref","_parentStack","_childStack","_childModified","ref","parentStack","childStack","childModified","ret","undefined","isNonEmptyReadonlyArray","parentFiberId","headNonEmpty","parentAncestors","tailNonEmpty","childFiberId","childRefValue","childAncestors","startTimeMillis","id","initial","joinAs","dual","self","fiberId","that","parentFiberRefs","forEach","fiberRef","childValue","symbol","equals","join","ancestor","wasModified","patch","diff","oldValue","newValue","newStack","slice","forkAs","childId","map","unsafeForkAs","stack","fork","fiberRefs","fromIterable","keys","setAll","forEachSequentialDiscard","fiberRefSet","getOrDefault","delete_","delete","none","some","getOrElse","updateAs","value","size","unsafeUpdateAs","oldStack","currentId","currentValue","updateManyAs","entries","values","length"],"sources":["../../../src/internal/fiberRefs.ts"],"sourcesContent":[null],"mappings":"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"}